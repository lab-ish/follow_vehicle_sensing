# Vehicle Sensing using Sound Map

> Identify vehicle type using sound in the direction estimated using sound map

Using S-shaped curves on a sound map, we know the vehicle running direction.
In this project, we improve the accuracy of vehicle type identification by adding the sounds obtained from the S-curve.

## Requirements

This software requires the packages below:

- wave
- numpy
- scipy
- matplotlib
- seaborn
- scikit-learn
- imblearn

## Submodules

This software relies on the submodules below:

- soundmap

## Usage

### Estimation

Copy `config_template.py` and modify for your configuration.
Execute `main.py` with `-c` option specifying the above configuration file.

```bash
% python3 main.py -c conf.py
```

If `-c` option is omitted, `config.py` is used as a configuration file.

`main.py` generates results below in the directory specified as `OUTDIR` in `main.py`:

- copy of the configuration file (eg: `20181125_1620_config.py` which includes execution date and time)
- output
  - confusion matrix file (eg: `20181125_1620_result.csv`): each line is a confusion matrix reshaped in (1,-1)
  - train score file (eg: `20181125_1620_score.csv`): scores of estimation result with training data

### Plot confusion matrix

Use `conf_mat_plotting.py` to plot confusion matrix.

```bash
% python3 conf_mat_plotting.py results/20181125_1620_result.csv
```

For file output, use `-p` option.

```bash
% python3 conf_mat_plotting.py -p test.eps results/20181125_1620_result.csv
```

Using `-c` option to specify configuration file, vehicle type labels are included in the plot.

```bash
% python3 conf_mat_plotting.py -p test.eps -c results/20190131_0749_config.py results/20190131_0749_result.csv
```

`-r` option outputs percentile confusion matrix.

### Grid Search

Configuration files with various parameter combinations can be generated by a grid-search shell script.

Copy `grid_template.py` and modify to prepare for parameter sets.
A parameter set is a list including parameter value candidates. Use `constraints()` function to put restrictions on parameter sets.

In this README, we assume `grid.py` is a grid-search configuration file.

Use `grid_config.py` to generate configuration files.
By default `grid_config.py` outputs configuration files in `conf/` directory. You can specify output directory using `-c` option.

```bash
% python3 grid_config.py -p conf/params.tsv grid.py
```

You can check the expected number of configuration files using `-t` option. Note that no configuration file is generated when `-t` option is specified.
```bash
% python3 grid_config.py -t grid.py
192
```

Finally, execute `grid.sh` with the grid-search parameter set file, which is one of the output of `grid_config.py`.

```bash
% ./grid_exec.sh main.py conf/params.csv
```

The grid-search parameter set file is copied to the output folder with the filename including execution datetime (eg: `results/20190130_2230_params.tsv`).


### Analysis

Use `grid_summary.py` for analysis.
We recommend to use ipython for analysis.

```python
ipython >>> %run grid_summary.py results_msp/20190130_2230_params.csv
ipython >>> sorted_param
```
## Our Papers

- B. Dawton, S. Ishida, Y. Hori, M. Uchino, Y. Arakawa, S. Tagashira, and A. Fukuda,
  "Initial Evaluation of Vehicle Type Identification using Roadside Stereo Microphones",
  IEEE Sensors and Applications Symposium (SAS), Kuala Lumpur, Malaysia, pp.1-6, Mar 2020.
  https://doi.org/10.1109/SAS48726.2020.9220076
- M. Uchino, B. Dawton, Y. Hori, S. Ishida, S. Tagashira, Y. Arakawa, and A. Fukuda,
  "Initial Design of Two-Stage Acoustic Vehicle Detection System for High Traffic Roads",
  International Workshop on Pervasive Computing for Vehicular Systems (PerVehicle), in conjunction with IEEE International Conference on Pervasive Computing and Communications (PerCom), Austin, TX, pp.590-595, Mar 2020.
  https://doi.org/10.1109/PerComWorkshops48775.2020.9156248
- S. Ishida, M. Uchino, C. Li, S. Tagashira, and A. Fukuda,
  "Design of Acoustic Vehicle Detector with Steady-Noise Suppression",
  IEEE International Conference on Intelligent Transportation Systems (ITSC), Auckland, New Zealand, pp.2848-2853, Oct 2019.
  https://doi.org/10.1109/ITSC.2019.8917289
- M. Uchino, S. Ishida, K. Kubo, S. Tagashira, and A. Fukuda,
  "Initial Design of Acoustic Vehicle Detector with Wind Noise Suppressor",
  International Workshop on Pervasive Computing for Vehicular Systems (PerVehicle), in conjunction with IEEE International Conference on Pervasive Computing and Communications (PerCom), Kyoto, Japan, pp.814-819, Mar 2019.
  https://doi.org/10.1109/PERCOMW.2019.8730822
- S. Ishida, J. Kajimura, M. Uchino, S. Tagashira, and A. Fukuda,
  "SAVeD: Acoustic Vehicle Detector with Speed Estimation capable of Sequential Vehicle Detection",
  IEEE International Conference on Intelligent Transportation Systems (ITSC), Maui, HI, pp.906-912, Nov 2018.
  https://doi.org/10.1109/ITSC.2018.8569727

## License

This software is released under the BSD 3-clause license. See `LICENSE.txt`.

Copyright (c) 2018-2024, Masahiko MIYAZAKI, Shigemi ISHIDA

If you use or refer to our codes in this repository, please cite our related papers above (of course, the one relates to your project).
